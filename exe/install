#!/bin/sh -e
# usage: ./exe/install [prefix] [--symlink]

prefix="$1"
mode="$2"

put_file() {
  if test "$mode" = "--symlink"
  then
    ln -sf "$@"
  else
    cp "$@"
  fi
}

put_headers() {
  source="$1"
  target="$2"
  mkdir -p "$target"
  put_file "$source"/*.h "$target"
  chmod 644 -R "$target"/*.h
  chmod 755 "$target"
}

put_headers "$PWD/src/c-precompiled/sph-db" "$prefix/usr/include/sph-db/"
put_headers "$PWD/src/c/foreign/sph-db/sph" "$prefix/usr/include/sph-db/sph"
rm "$prefix/usr/include/sph-db/sph/test.h"
if ! test -d "$prefix/usr/lib"
then
  mkdir -p "$prefix/usr/lib"
  chmod 755 "$prefix/usr/lib"
fi

put_file "$PWD/tmp/libsph-db.so" "$prefix/usr/lib"
chmod 644 "$prefix/usr/lib/libsph-db.so"
